<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Dave Woodall</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Notes on using the Pundit Gem" />
    <meta name="keywords" content="dave woodall boulder coder wwwoodall fake farm leavelist fakefarm ruby rails pundit" />
    <meta name="author" content="dave woodall wwwoodall" />
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/main.css">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,900" rel="stylesheet">
  </head>
  <body class='blog'>
    <header class="header headline">
      <h1 class='h1'>For your eyes only.</h1>
      <h2 class='h1-alt'>Learning the Pundit Gem</h2>
      <p class='p'>Pundit provides a set of helpers which guide you in leveraging regular Ruby classes and object oriented design patterns to build a simple, robust and scaleable authorization system.</p>
      <p class='p'>Pundit strongly encourages you to model your application in such a way that the only context you need for authorization is a user object and a domain model that you want to check authorization for. </p>
    </header>
    <section class="section overview">
      <ul>
        <li><h2 class='h2'>installation</h2></li>
        <li>
          <h2 class='h2'>policies</h2>
          <p class='p'>Pundit makes the following assumptions about policy classes</p>
          <ul>
            <li>The class has the same name as some kind of model class, only suffixed with the word "Policy".</li>
            <li>The first argument is a user. In your controller, Pundit will call the current_user method to retrieve what to send into this argument</li>
            <li>The second argument is some kind of model object, whose authorization you want to check. This does not need to be an ActiveRecord or even an ActiveModel object, it can be anything really.</li>
            <li>The class implements some kind of query method, in this case update?. Usually, this will map to the name of a particular controller action.</li>
            <li>Inherit from the application policy created by the generator</li>
            <li>In the generated <code>ApplicationPolicy</code>, the model object is called record.</li>
          </ul>
          <h3 class='h3'>Policy usecases</h3>
          <p class='p'>Policies support a few ways of working. The most popular is when you have a model and an instance variable. But that is not required. You can also use Pundit without a backing model.</p>
          <ul>
            <li>Instance &amp; Model usecase</li>
            <li>Non-instance &amp; Model usecase</li>
            <li>Non-Model &amp; Non-instance usecase (Headless Policies)</li>
          </ul>
        </li>
        <li>
          <h2 class='h2'>pundit methods</h2>
          <ul>
            <li><code>#authorize</code></li>
            <li>
              <code>#policy</code>
              <p class='p'>this method can be used in both the view and controller</p>
              <p class='p'>This is especially useful for conditionally showing links or buttons in the view:</p>
              <pre>
                <code>
                  <% if policy(@post).update? %>
                    <%= link_to "Edit post", edit_post_path(@post) %>
                  <% end %>
                </code>
              </pre>
            </li>
          </ul>
        </li>
        <li>
          <h2 class='h2'>pundit classes</h2>
          <ul>
            <li>
              <h3 class='h3'>ApplicationPolicy</h3>
              <aside class="">
                <h4 class='h4'>The generator</h4>
                <p class='p'>Use the generator to create </p>
                <code>rails g pundit:install</code>
                <p class='p'>After generating your application policy, restart the Rails server so that Rails can pick up any classes in the new app/policies/ directory.</p>
                <p class='p'>In the generated ApplicationPolicy, the model object is called <code>record</code>.</p>
              </aside>
            </li>
          </ul>
        </li>
        <li><h2 class='h2'>headless policies</h2></li>
        <li>
          <h2 class='h2'>scopes</h2>
          <p class='p'>Scopes are like active model scopes that will help query the proper content to be shown in the controller and view</p>
          <h3 class='h3'>Methods</h3>
          <ul>
            <li>resolve</li>
            <li>policy_scope</li>
          </ul>
        </li>
        <li><h2 class='h2'>ensuring policies and scopes are used</h2></li>
        <li>
          <h2 class='h2'>generators</h2>
          <p class='p'>There are two generators</p>
          <p class='p'>1. install with <code>rails g pundit:install</code></p>
          <p class='p'>2. add policies with <code>rails g pundit:policy [post]</code></p>
        </li>
        <li><h2 class='h2'>testing</h2></li>
      </ul>
      <h3 class='h3'>Moving Parts</h3>
      <div class="image overview">
        <img src="./img/pundit_slide_1.png" alt="">
      </div>
    </section>
    <section class="section links resources">
      <a href="https://github.com/elabs/pundit/blob/master/README.md">repo readme</a>
    </section>
    <section class="section install">
      <h2 class='h2'>Installation</h2>
      <code>
        <pre>gem "pundit"</pre>
      </code>
      <p class='p'>
        Include Pundit in your application controller:
      </p>

      <code>
        <pre>
          class ApplicationController < ActionController::Base
            include Pundit
            protect_from_forgery
          end
        </pre>
      </code>
      <p class='p'>
        Optionally, you can run the generator, which will set up an application policy with some useful defaults for you:
      </p>
      <code>
        <pre>rails g pundit:install</pre>
      </code>
      <p class='p'>
        After generating your application policy, restart the Rails server so that Rails can pick up any classes in the new app/policies/ directory.
      </p>
    </section>
    <footer class='footer-1'>
    </footer>
    <div class="scripts">
      <script src="./js/vendor/jquery.min.js"></script>
      <script src="./js/vendor/underscore.min.js"></script>
      <script src="./js/vendor/backbone.min.js"></script>
      <script src="./js/main.js"></script>
      <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-40303853-1','auto');ga('send','pageview');
      </script>
    </div>
  </body>
</html>
